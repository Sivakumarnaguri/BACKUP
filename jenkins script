---
- name: Install and configure PHP CLI for CI pipelines
  hosts: all
  become: yes

  vars:
    php_ini_path: "/etc/php/7.4/cli/php.ini"  # Change 7.4 to match your system's PHP version if needed

  tasks:
    - name: Update apt package index
      apt:
        update_cache: yes

    - name: Install PHP CLI and required extensions
      apt:
        name:
          - php-cli
          - php-gd
          - php-mbstring
          - php-xml
          - php-curl
        state: present

    - name: Ensure memory_limit is set to 256M
      lineinfile:
        path: "{{ php_ini_path }}"
        regexp: '^memory_limit\s*='
        line: 'memory_limit = 256M'

    - name: Ensure max_input_vars is set to 2000
      lineinfile:
        path: "{{ php_ini_path }}"
        regexp: '^max_input_vars\s*='
        line: 'max_input_vars = 2000'
